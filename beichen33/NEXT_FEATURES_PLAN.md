# åç»­åŠŸèƒ½å¼€å‘è®¡åˆ’

## âœ… å·²å®Œæˆçš„ä¿®å¤å’ŒåŠŸèƒ½

### 1. ä¿®å¤åç«¯æ•°æ®åŠ è½½é”™è¯¯
- âœ… ä¿®å¤ Prisma åˆ†é¡µå‚æ•°é”™è¯¯ï¼ˆ`take` missingï¼‰
- âœ… ä¿®å¤ studentsã€ingredientsã€dishes ä¸‰ä¸ªæ¨¡å—çš„ controller
- âœ… åç«¯æœåŠ¡å·²é‡å¯å¹¶æ­£å¸¸è¿è¡Œ

### 2. å®Œæˆé¡µé¢ä¸­æ–‡åŒ–
- âœ… ç™»å½•é¡µé¢
- âœ… ä»ªè¡¨æ¿
- âœ… å­¦ç”Ÿç®¡ç†
- âœ… ç­çº§ç®¡ç†
- âœ… é£Ÿæç®¡ç†
- âœ… èœå“ç®¡ç†ï¼ˆDishesï¼‰
- âœ… èœå•ç®¡ç†ï¼ˆMenusï¼‰
- âœ… è¥å…»åˆ†æï¼ˆNutrition Analysisï¼‰

### 3. æ·»åŠ ç­çº§ CRUD åŠŸèƒ½
- âœ… æ·»åŠ ç­çº§ï¼ˆAdd Classï¼‰
- âœ… ç¼–è¾‘ç­çº§ï¼ˆEdit Classï¼‰
- âœ… åˆ é™¤ç­çº§ï¼ˆDelete Classï¼‰
- âœ… æŸ¥çœ‹ç­çº§åˆ—è¡¨

---

## ğŸ“‹ å¾…å¼€å‘åŠŸèƒ½æ¸…å•

### ä¼˜å…ˆçº§ 1ï¼šç”¨æˆ·å’Œæ•™å¸ˆç®¡ç†ç³»ç»Ÿ

#### 1.1 ç”¨æˆ·ç±»å‹å®šä¹‰

éœ€è¦åœ¨ Prisma Schema ä¸­å®šä¹‰ç”¨æˆ·è§’è‰²ï¼š

```prisma
enum UserRole {
  ADMIN      // ç®¡ç†å‘˜ï¼šå…¨æƒé™
  TEACHER    // æ•™å¸ˆï¼šç®¡ç†æœ¬ç­çº§å­¦ç”Ÿ
  PARENT     // å®¶é•¿ï¼šæŸ¥çœ‹è‡ªå·±å­©å­çš„ä¿¡æ¯
  STUDENT    // å­¦ç”Ÿï¼šæŸ¥çœ‹ä¸ªäººä¿¡æ¯
}

model User {
  id          String   @id @default(cuid())
  email       String   @unique
  password    String
  name        String
  role        UserRole
  studentId   String?  @unique  // å…³è”å­¦ç”Ÿ
  teacherId   String?  @unique  // å…³è”æ•™å¸ˆ
  classId     String?  // å…³è”ç­çº§ï¼ˆæ•™å¸ˆã€å­¦ç”Ÿï¼‰

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  student     Student?  @relation(fields: [studentId], references: [id])
  teacher     Teacher?  @relation(fields: [teacherId], references: [id])
  class       Class?    @relation(fields: [classId], references: [id])
}

model Teacher {
  id          String   @id @default(cuid())
  name        String
  phone       String?
  email       String?
  position    String?  // èŒä½
  classId     String?  // ä¸»ç®¡ç­çº§

  user        User?
  class       Class?   @relation(fields: [classId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}
```

#### 1.2 åŠŸèƒ½éœ€æ±‚

**ç®¡ç†å‘˜åŠŸèƒ½ï¼š**
- åˆ›å»ºæ•™å¸ˆè´¦å·ï¼ˆè‡ªåŠ¨ç”Ÿæˆç”¨æˆ·ï¼‰
- åˆ†é…æ•™å¸ˆåˆ°ç­çº§
- åˆ›å»ºå­¦ç”Ÿè´¦å·ï¼ˆè‡ªåŠ¨å…³è”å­¦ç”Ÿè®°å½•ï¼‰
- åˆ›å»ºå®¶é•¿è´¦å·ï¼ˆå…³è”åˆ°å­¦ç”Ÿï¼‰
- æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·åˆ—è¡¨

**æ•™å¸ˆåŠŸèƒ½ï¼š**
- ç™»å½•ç³»ç»Ÿ
- æŸ¥çœ‹æœ¬ç­çº§å­¦ç”Ÿåˆ—è¡¨
- æŸ¥çœ‹æœ¬ç­çº§å­¦ç”Ÿçš„è¯¦ç»†ä¿¡æ¯
- å‘å¸ƒç­çº§é€šçŸ¥
- æäº¤è¡¨å•ç”³è¯·

**å­¦ç”ŸåŠŸèƒ½ï¼š**
- ç™»å½•ç³»ç»Ÿï¼ˆå¯é€‰ï¼‰
- æŸ¥çœ‹ä¸ªäººä¿¡æ¯
- æŸ¥çœ‹ä¸ªäººæˆé•¿è®°å½•
- æŸ¥çœ‹ç­çº§ä¿¡æ¯

**å®¶é•¿åŠŸèƒ½ï¼š**
- ç™»å½•ç³»ç»Ÿ
- æŸ¥çœ‹å­©å­çš„ä¿¡æ¯
- æŸ¥çœ‹å­©å­çš„æˆé•¿è®°å½•
- æŸ¥çœ‹ç­çº§é€šçŸ¥
- æäº¤è¯·å‡ç”³è¯·ç­‰è¡¨å•

#### 1.3 å®æ–½æ­¥éª¤

1. **æ•°æ®åº“è®¾è®¡** (0.5å¤©)
   - æ›´æ–° Prisma Schema
   - åˆ›å»ºè¿ç§»æ–‡ä»¶
   - è¿è¡Œè¿ç§»

2. **åç«¯ API å¼€å‘** (1å¤©)
   - ç”¨æˆ·ç®¡ç† APIï¼ˆCRUDï¼‰
   - æ•™å¸ˆç®¡ç† APIï¼ˆCRUDï¼‰
   - æƒé™ä¸­é—´ä»¶ï¼ˆåŸºäºè§’è‰²ï¼‰
   - ç™»å½•éªŒè¯æ›´æ–°ï¼ˆæ”¯æŒå¤šè§’è‰²ï¼‰

3. **å‰ç«¯é¡µé¢å¼€å‘** (1.5å¤©)
   - ç”¨æˆ·ç®¡ç†é¡µé¢
   - æ•™å¸ˆç®¡ç†é¡µé¢
   - æƒé™è·¯ç”±ä¿æŠ¤
   - è§’è‰²ç‰¹å®šçš„ä»ªè¡¨æ¿

---

### ä¼˜å…ˆçº§ 2ï¼šè¡¨å•å®¡æ‰¹ç³»ç»Ÿ

#### 2.1 åŠŸèƒ½éœ€æ±‚

**è¡¨å•ç±»å‹ï¼š**
- è¯·å‡ç”³è¯·ï¼ˆå­¦ç”Ÿ/æ•™å¸ˆï¼‰
- ç‰©èµ„ç”³è¯·
- æ´»åŠ¨å®¡æ‰¹
- è‡ªå®šä¹‰è¡¨å•

**å®¡æ‰¹æµç¨‹ï¼š**
1. æäº¤äººå¡«å†™è¡¨å•
2. æŒ‡å®šå®¡æ‰¹äººï¼ˆå•äººæˆ–å¤šäººï¼‰
3. å®¡æ‰¹äººæ”¶åˆ°é€šçŸ¥
4. å®¡æ‰¹äººæ‰¹å‡†/æ‹’ç»
5. æäº¤äººæ”¶åˆ°ç»“æœé€šçŸ¥

#### 2.2 æ•°æ®åº“è®¾è®¡

```prisma
enum FormStatus {
  DRAFT      // è‰ç¨¿
  PENDING    // å¾…å®¡æ‰¹
  APPROVED   // å·²æ‰¹å‡†
  REJECTED   // å·²æ‹’ç»
  CANCELLED  // å·²å–æ¶ˆ
}

model FormTemplate {
  id          String   @id @default(cuid())
  name        String   // è¡¨å•åç§°
  description String?
  fields      Json     // è¡¨å•å­—æ®µå®šä¹‰
  approvers   String[] // å®¡æ‰¹äººIDåˆ—è¡¨
  isActive    Boolean  @default(true)

  submissions FormSubmission[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model FormSubmission {
  id          String      @id @default(cuid())
  templateId  String
  submitterId String      // æäº¤äººID
  data        Json        // è¡¨å•æ•°æ®
  status      FormStatus  @default(PENDING)

  template    FormTemplate @relation(fields: [templateId], references: [id])
  approvals   FormApproval[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model FormApproval {
  id           String      @id @default(cuid())
  submissionId String
  approverId   String      // å®¡æ‰¹äººID
  status       FormStatus  // APPROVED æˆ– REJECTED
  comment      String?     // å®¡æ‰¹æ„è§

  submission   FormSubmission @relation(fields: [submissionId], references: [id])

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}
```

#### 2.3 å®æ–½æ­¥éª¤

1. **æ•°æ®åº“è®¾è®¡** (0.5å¤©)
   - æ›´æ–° Prisma Schema
   - åˆ›å»ºè¿ç§»

2. **åç«¯ API** (1.5å¤©)
   - è¡¨å•æ¨¡æ¿ CRUD
   - è¡¨å•æäº¤ API
   - å®¡æ‰¹ API
   - é€šçŸ¥ç³»ç»Ÿï¼ˆå¯é€‰ï¼‰

3. **å‰ç«¯å¼€å‘** (2å¤©)
   - åŠ¨æ€è¡¨å•æ„å»ºå™¨
   - è¡¨å•å¡«å†™é¡µé¢
   - å®¡æ‰¹åˆ—è¡¨é¡µé¢
   - å®¡æ‰¹è¯¦æƒ…é¡µé¢

---

### ä¼˜å…ˆçº§ 3ï¼šæƒé™æ§åˆ¶ä¼˜åŒ–

#### 3.1 è·¯ç”±æƒé™

```tsx
// ç¤ºä¾‹ï¼šåŸºäºè§’è‰²çš„è·¯ç”±ä¿æŠ¤
const ROLE_ROUTES = {
  ADMIN: ['/students', '/classes', '/teachers', '/users', '/canteen', '/forms', '/reports'],
  TEACHER: ['/students', '/forms', '/reports'],
  PARENT: ['/students/:myChildId', '/forms'],
  STUDENT: ['/profile', '/records'],
};
```

#### 3.2 æ•°æ®æƒé™

- **ç®¡ç†å‘˜**ï¼šæŸ¥çœ‹æ‰€æœ‰æ•°æ®
- **æ•™å¸ˆ**ï¼šåªèƒ½æŸ¥çœ‹æœ¬ç­çº§å­¦ç”Ÿæ•°æ®
- **å®¶é•¿**ï¼šåªèƒ½æŸ¥çœ‹è‡ªå·±å­©å­çš„æ•°æ®
- **å­¦ç”Ÿ**ï¼šåªèƒ½æŸ¥çœ‹ä¸ªäººæ•°æ®

åç«¯éœ€è¦åœ¨ Service å±‚æ·»åŠ æƒé™è¿‡æ»¤ï¼š

```typescript
// ç¤ºä¾‹ï¼šæ•™å¸ˆåªèƒ½æŸ¥çœ‹æœ¬ç­çº§å­¦ç”Ÿ
async findAll(userId: string) {
  const user = await this.prisma.user.findUnique({ where: { id: userId } });

  if (user.role === 'TEACHER') {
    return this.prisma.student.findMany({
      where: { classId: user.classId }
    });
  }

  // ç®¡ç†å‘˜è¿”å›æ‰€æœ‰
  return this.prisma.student.findMany();
}
```

---

## ğŸ›  æŠ€æœ¯å®æ–½å»ºè®®

### 1. ç”¨æˆ·ç®¡ç†å®æ–½é¡ºåº

**ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€åŠŸèƒ½**
1. æ›´æ–°æ•°æ®åº“ Schema
2. åˆ›å»ºæ•™å¸ˆç®¡ç†åç«¯ API
3. åˆ›å»ºæ•™å¸ˆç®¡ç†å‰ç«¯é¡µé¢
4. æµ‹è¯•æ•™å¸ˆè´¦å·ç™»å½•

**ç¬¬äºŒé˜¶æ®µï¼šæ‰©å±•åŠŸèƒ½**
1. æ·»åŠ å­¦ç”Ÿ/å®¶é•¿ç”¨æˆ·åˆ›å»º
2. å®ç°è§’è‰²ç‰¹å®šä»ªè¡¨æ¿
3. æ·»åŠ æƒé™è·¯ç”±ä¿æŠ¤

### 2. è¡¨å•å®¡æ‰¹å®æ–½é¡ºåº

**ç¬¬ä¸€é˜¶æ®µï¼šåŸºç¡€å®¡æ‰¹**
1. è®¾è®¡æ•°æ®åº“ç»“æ„
2. åˆ›å»ºç®€å•çš„è¯·å‡è¡¨å•
3. å®ç°å•äººå®¡æ‰¹æµç¨‹
4. å‰ç«¯è¡¨å•æäº¤é¡µé¢

**ç¬¬äºŒé˜¶æ®µï¼šé«˜çº§åŠŸèƒ½**
1. åŠ¨æ€è¡¨å•æ„å»ºå™¨
2. å¤šäººå®¡æ‰¹æµç¨‹
3. å®¡æ‰¹é€šçŸ¥ç³»ç»Ÿ

---

## ğŸ“ å¼€å‘æ—¶é—´ä¼°ç®—

| åŠŸèƒ½æ¨¡å— | é¢„è®¡æ—¶é—´ | å¤æ‚åº¦ |
|---------|---------|--------|
| æ•™å¸ˆç®¡ç†ç³»ç»Ÿ | 2-3 å¤© | ä¸­ |
| ç”¨æˆ·å¤šè§’è‰²ç™»å½• | 1-2 å¤© | ä¸­ |
| æƒé™æ§åˆ¶ç³»ç»Ÿ | 1-2 å¤© | é«˜ |
| è¡¨å•æ¨¡æ¿ç³»ç»Ÿ | 2-3 å¤© | é«˜ |
| è¡¨å•å®¡æ‰¹æµç¨‹ | 1-2 å¤© | ä¸­ |
| **æ€»è®¡** | **7-12 å¤©** | - |

---

## ğŸš€ å¿«é€Ÿå¼€å§‹å»ºè®®

ç”±äºåŠŸèƒ½è¾ƒå¤šä¸”å¤æ‚ï¼Œå»ºè®®ï¼š

### æ–¹æ¡ˆ Aï¼šæœ€å°å¯ç”¨äº§å“ï¼ˆMVPï¼‰
1. **å…ˆå®Œæˆæ•™å¸ˆç®¡ç†**ï¼ˆ2å¤©ï¼‰
   - æ•™å¸ˆ CRUD
   - æ•™å¸ˆè´¦å·ç™»å½•
   - æ•™å¸ˆæŸ¥çœ‹æœ¬ç­çº§å­¦ç”Ÿ

2. **å†æ·»åŠ ç®€å•è¡¨å•å®¡æ‰¹**ï¼ˆ2å¤©ï¼‰
   - å›ºå®šæ ¼å¼çš„è¯·å‡è¡¨å•
   - å•äººå®¡æ‰¹
   - å®¡æ‰¹åˆ—è¡¨

### æ–¹æ¡ˆ Bï¼šå®Œæ•´åŠŸèƒ½å¼€å‘
æŒ‰ç…§ä¸Šè¿°ä¼˜å…ˆçº§é¡ºåºï¼Œå®Œæ•´å¼€å‘æ‰€æœ‰åŠŸèƒ½ï¼ˆ7-12å¤©ï¼‰

---

## ğŸ’¡ å½“å‰å¯ä»¥ç«‹å³ä½¿ç”¨çš„åŠŸèƒ½

1. âœ… ç®¡ç†å‘˜ç™»å½•
2. âœ… å­¦ç”Ÿç®¡ç†ï¼ˆå®Œæ•´ CRUDï¼‰
3. âœ… ç­çº§ç®¡ç†ï¼ˆå®Œæ•´ CRUDï¼‰
4. âœ… é£Ÿæç®¡ç†ï¼ˆå®Œæ•´ CRUDï¼‰
5. âœ… å…¨ä¸­æ–‡ç•Œé¢
6. âœ… ä¸­è‹±æ–‡åˆ‡æ¢

---

## ğŸ“§ åç»­å¼€å‘å»ºè®®

å»ºè®®å…ˆæµ‹è¯•å½“å‰åŠŸèƒ½ï¼Œç¡®è®¤åŸºæœ¬æµç¨‹æ²¡æœ‰é—®é¢˜åï¼Œå†è®¨è®ºï¼š
1. éœ€è¦å“ªäº›ç”¨æˆ·è§’è‰²ï¼Ÿ
2. å®¡æ‰¹æµç¨‹çš„å…·ä½“éœ€æ±‚ï¼Ÿ
3. æ˜¯å¦éœ€è¦é€šçŸ¥ç³»ç»Ÿï¼Ÿ
4. æ•°æ®æƒé™çš„å…·ä½“è§„åˆ™ï¼Ÿ

è¿™æ ·å¯ä»¥ç¡®ä¿å¼€å‘çš„åŠŸèƒ½ç¬¦åˆå®é™…éœ€æ±‚ã€‚
